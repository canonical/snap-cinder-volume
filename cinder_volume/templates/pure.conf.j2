{# Pure Storage FlashArray backend stanza template for cinder.conf.d
   Renders each option only when it has a value so blank settings vanish. #}
{%- macro cfg(name, value) -%}
{%-   if value is not none and value != '' -%}
{{ name }} = {{ value }}
{%-   endif -%}
{%- endmacro %}

[{{ pure_ctx.backend_name }}]

# ----------------------------------------------------------------------
# Core driver / connection
# ----------------------------------------------------------------------
{{ cfg('volume_driver', pure_ctx.driver_class) }}
{{ cfg('san_ip', pure_ctx.san_ip) }}
{{ cfg('pure_api_token', pure_ctx.pure_api_token) }}
enable_unsupported_driver = True

# ----------------------------------------------------------------------
# Protocol-specific settings
# ----------------------------------------------------------------------
{{ cfg('pure_host_personality', pure_ctx.pure_host_personality) }}
{{ cfg('pure_iscsi_cidr', pure_ctx.pure_iscsi_cidr) }}
{{ cfg('pure_iscsi_cidr_list', pure_ctx.pure_iscsi_cidr_list|join(',') if pure_ctx.pure_iscsi_cidr_list) }}
{{ cfg('pure_nvme_cidr', pure_ctx.pure_nvme_cidr) }}
{{ cfg('pure_nvme_cidr_list', pure_ctx.pure_nvme_cidr_list|join(',') if pure_ctx.pure_nvme_cidr_list) }}
{{ cfg('pure_nvme_transport', pure_ctx.pure_nvme_transport) }}

# ----------------------------------------------------------------------
# Advanced features
# ----------------------------------------------------------------------
{{ cfg('pure_automatic_max_oversubscription_ratio', pure_ctx.pure_automatic_max_oversubscription_ratio) }}
{{ cfg('pure_eradicate_on_delete', pure_ctx.pure_eradicate_on_delete) }}

# ----------------------------------------------------------------------
# Replication settings
# ----------------------------------------------------------------------
{{ cfg('pure_replica_interval_default', pure_ctx.pure_replica_interval_default) }}
{{ cfg('pure_replica_retention_short_term_default', pure_ctx.pure_replica_retention_short_term_default) }}
{{ cfg('pure_replica_retention_long_term_per_day_default', pure_ctx.pure_replica_retention_long_term_per_day_default) }}
{{ cfg('pure_replica_retention_long_term_default', pure_ctx.pure_replica_retention_long_term_default) }}
{{ cfg('pure_replication_pg_name', pure_ctx.pure_replication_pg_name) }}
{{ cfg('pure_replication_pod_name', pure_ctx.pure_replication_pod_name) }}
{{ cfg('pure_trisync_enabled', pure_ctx.pure_trisync_enabled) }}
{{ cfg('pure_trisync_pg_name', pure_ctx.pure_trisync_pg_name) }}

# --- End of Pure Storage backend stanza ---
