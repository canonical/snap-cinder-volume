{# Hitachi VSP backend stanza template for cinder.conf.d
   Renders each option only when it has a value so blank settings vanish. #}
{%- macro cfg(name, value) -%}
{%-   if value is not none and value != '' -%}
{{ name }} = {{ value }}
{%-   endif -%}
{%- endmacro %}

[{{ hitachi_ctx.backend_name }}]

# ----------------------------------------------------------------------
# Core driver / connection
# ----------------------------------------------------------------------
{{ cfg('volume_driver', hitachi_ctx.driver_class) }}
{{ cfg('san_ip', hitachi_ctx.san_ip) }}
{{ cfg('san_login', hitachi_ctx.san_login) }}
{{ cfg('san_password', hitachi_ctx.san_password) }}
{{ cfg('hitachi_storage_id', hitachi_ctx.hitachi_storage_id) }}
{{ cfg('hitachi_pools', hitachi_ctx.hitachi_pools) }}
enable_unsupported_driver = True

# ----------------------------------------------------------------------
# Copy & replication tuning
# ----------------------------------------------------------------------
{{ cfg('hitachi_copy_speed', hitachi_ctx.hitachi_copy_speed) }}
{{ cfg('hitachi_copy_check_interval', hitachi_ctx.hitachi_copy_check_interval) }}
{{ cfg('hitachi_async_copy_check_interval', hitachi_ctx.hitachi_async_copy_check_interval) }}
{{ cfg('hitachi_replication_copy_speed', hitachi_ctx.hitachi_replication_copy_speed) }}

# ----------------------------------------------------------------------
# Timing / retry / timeout knobs
# ----------------------------------------------------------------------
{{ cfg('hitachi_exec_retry_interval', hitachi_ctx.hitachi_exec_retry_interval) }}
{{ cfg('hitachi_extend_timeout', hitachi_ctx.hitachi_extend_timeout) }}
{{ cfg('hitachi_lun_retry_interval', hitachi_ctx.hitachi_lun_retry_interval) }}
{{ cfg('hitachi_lun_timeout', hitachi_ctx.hitachi_lun_timeout) }}
{{ cfg('hitachi_lock_timeout', hitachi_ctx.hitachi_lock_timeout) }}
{{ cfg('hitachi_state_transition_timeout', hitachi_ctx.hitachi_state_transition_timeout) }}
{{ cfg('hitachi_restore_timeout', hitachi_ctx.hitachi_restore_timeout) }}

# ----------------------------------------------------------------------
# Pools / LDEV ranges
# ----------------------------------------------------------------------
{{ cfg('hitachi_ldev_range', hitachi_ctx.hitachi_ldev_range) }}
{{ cfg('hitachi_mirror_ldev_range', hitachi_ctx.hitachi_mirror_ldev_range) }}
{{ cfg('hitachi_snap_pool', hitachi_ctx.hitachi_snap_pool) }}

# ----------------------------------------------------------------------
# Ports & zoning
# ----------------------------------------------------------------------
{{ cfg('hitachi_target_ports', hitachi_ctx.hitachi_target_ports) }}
{{ cfg('hitachi_compute_target_ports', hitachi_ctx.hitachi_compute_target_ports) }}
{{ cfg('hitachi_zoning_request', hitachi_ctx.hitachi_zoning_request) }}
{{ cfg('hitachi_port_scheduler', hitachi_ctx.hitachi_port_scheduler) }}
{{ cfg('hitachi_path_group_id', hitachi_ctx.hitachi_path_group_id) }}

# ----------------------------------------------------------------------
# Host‑group automation & naming
# ----------------------------------------------------------------------
{{ cfg('hitachi_group_create', hitachi_ctx.hitachi_group_create) }}
{{ cfg('hitachi_group_delete', hitachi_ctx.hitachi_group_delete) }}
{{ cfg('hitachi_group_name_format', hitachi_ctx.hitachi_group_name_format) }}

# ----------------------------------------------------------------------
# QoS & performance
# ----------------------------------------------------------------------
{{ cfg('hitachi_discard_zero_page', hitachi_ctx.hitachi_discard_zero_page) }}

# ----------------------------------------------------------------------
# Replication / Global‑Active‑Device / mirror settings
# ----------------------------------------------------------------------
{{ cfg('hitachi_replication_number', hitachi_ctx.hitachi_replication_number) }}
{{ cfg('hitachi_replication_status_check_long_interval', hitachi_ctx.hitachi_replication_status_check_long_interval) }}
{{ cfg('hitachi_replication_status_check_short_interval', hitachi_ctx.hitachi_replication_status_check_short_interval) }}
{{ cfg('hitachi_replication_status_check_timeout', hitachi_ctx.hitachi_replication_status_check_timeout) }}
{{ cfg('hitachi_mirror_pool', hitachi_ctx.hitachi_mirror_pool) }}
{{ cfg('hitachi_mirror_target_ports', hitachi_ctx.hitachi_mirror_target_ports) }}
{{ cfg('hitachi_mirror_compute_target_ports', hitachi_ctx.hitachi_mirror_compute_target_ports) }}
{{ cfg('hitachi_mirror_pair_target_number', hitachi_ctx.hitachi_mirror_pair_target_number) }}
{{ cfg('hitachi_mirror_rest_api_ip', hitachi_ctx.hitachi_mirror_rest_api_ip) }}
{{ cfg('hitachi_mirror_rest_api_port', hitachi_ctx.hitachi_mirror_rest_api_port) }}
{{ cfg('hitachi_mirror_rest_user', hitachi_ctx.hitachi_mirror_rest_user) }}
{{ cfg('hitachi_mirror_rest_password', hitachi_ctx.hitachi_mirror_rest_password) }}
{{ cfg('hitachi_mirror_rest_pair_target_ports', hitachi_ctx.hitachi_mirror_rest_pair_target_ports) }}
{{ cfg('hitachi_mirror_storage_id', hitachi_ctx.hitachi_mirror_storage_id) }}
{{ cfg('hitachi_mirror_snap_pool', hitachi_ctx.hitachi_mirror_snap_pool) }}
{{ cfg('hitachi_mirror_use_chap_auth', hitachi_ctx.hitachi_mirror_use_chap_auth) }}
{{ cfg('hitachi_mirror_auth_user', hitachi_ctx.hitachi_mirror_auth_user) }}
{{ cfg('hitachi_mirror_auth_password', hitachi_ctx.hitachi_mirror_auth_password) }}
{{ cfg('hitachi_quorum_disk_id', hitachi_ctx.hitachi_quorum_disk_id) }}
{{ cfg('hitachi_set_mirror_reserve_attribute', hitachi_ctx.hitachi_set_mirror_reserve_attribute) }}

# ----------------------------------------------------------------------
# REST API tuning
# ----------------------------------------------------------------------
{{ cfg('hitachi_rest_connect_timeout', hitachi_ctx.hitachi_rest_connect_timeout) }}
{{ cfg('hitachi_rest_timeout', hitachi_ctx.hitachi_rest_timeout) }}
{{ cfg('hitachi_rest_get_api_response_timeout', hitachi_ctx.hitachi_rest_get_api_response_timeout) }}
{{ cfg('hitachi_rest_job_api_response_timeout', hitachi_ctx.hitachi_rest_job_api_response_timeout) }}
{{ cfg('hitachi_rest_keep_session_loop_interval', hitachi_ctx.hitachi_rest_keep_session_loop_interval) }}
{{ cfg('hitachi_rest_server_busy_timeout', hitachi_ctx.hitachi_rest_server_busy_timeout) }}
{{ cfg('hitachi_rest_another_ldev_mapped_retry_timeout', hitachi_ctx.hitachi_rest_another_ldev_mapped_retry_timeout) }}
{{ cfg('hitachi_rest_disable_io_wait', hitachi_ctx.hitachi_rest_disable_io_wait) }}
{{ cfg('hitachi_rest_pair_target_ports', hitachi_ctx.hitachi_rest_pair_target_ports) }}
{{ cfg('hitachi_rest_tcp_keepalive', hitachi_ctx.hitachi_rest_tcp_keepalive) }}
{{ cfg('hitachi_rest_tcp_keepidle', hitachi_ctx.hitachi_rest_tcp_keepidle) }}
{{ cfg('hitachi_rest_tcp_keepintvl', hitachi_ctx.hitachi_rest_tcp_keepintvl) }}
{{ cfg('hitachi_rest_tcp_keepcnt', hitachi_ctx.hitachi_rest_tcp_keepcnt) }}

# ----------------------------------------------------------------------
# Misc
# ----------------------------------------------------------------------
{{ cfg('hitachi_pair_target_number', hitachi_ctx.hitachi_pair_target_number) }}

# --- End of Hitachi backend stanza ---

